# Data Flow

This document outlines the end-to-end data flow for MLPlayground: where data comes from, how it's transformed, and how it flows through the API and Streamlit UI.

## Overview

High level pipeline:

1. Data sources:
   - Historical yields: USDA NASS QuickStats (stored in `yields` table)
   - Climate data: NASA NLDAS or equivalent gridded datasets (stored in `weather` table)
   - Soil data: SSURGO-derived properties (stored in `soil` table)

2. Ingestion & ETL:
   - Raw data is ingested by scripts in `src/utils/` (e.g., `getYieldData.py`, `getWeatherData.py`, `getSoilData.py`).
   - ETL scripts normalize column names, compute derived features (GDD, cumulative precipitation), and persist cleaned tables to the database.

3. API layer (FastAPI):
   - The `backend/` service exposes lightweight endpoints: `/yields/`, `/weather/`, `/soil/`.
   - Each endpoint accepts query parameters (state, county, year, crop, etc.) and returns JSON lists of records.

4. Streamlit UI:
   - The Streamlit frontend (`src/pages/*`) calls the FastAPI endpoints via `src/utils/db_access.py`.
   - Fetched JSON is converted to `pandas.DataFrame` and stored in `st.session_state['df']` for downstream pages (profiling and modeling).

5. Modeling & Explainability:
   - The modeling page uses PyCaret to setup and compare models on the selected DataFrame.
   - For explainability, SHAP and LIME artifacts are generated and saved alongside model artifacts.

## Feature Engineering

- Growing Degree Days (GDD): computed from daily temperature records as a cumulative seasonal metric.
- Seasonal aggregates: sum/mean of precipitation and temperature over growing season windows.
- Soil normalization: texture fractions (`sand_pct`, `silt_pct`, `clay_pct`) are normalized and used directly.

## Deployment notes

- In Docker Compose, the API runs as `api:8000` and Streamlit connects to it via `http://api:8000`.
- For local development, run the API with Uvicorn and point Streamlit to `http://localhost:8000`.

## Troubleshooting

- Use `/openapi.json` on the API to list registered endpoints.
- Seed sample data with the `0_DBTest` Streamlit page or `db/init_db.py` during development.


---

Generated by automation; expand with concrete diagrams or example payloads as needed.
